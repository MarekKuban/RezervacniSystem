<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>V√Ωbƒõr jazyka</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <meta http-equiv="refresh" content="30">
</head>
<body class="bg-light">

<div class="container py-5">

    <div class="text-center mb-4">
        <img th:src="@{/img/oavm _logo_dlouhe.png}" alt="Logo ≈°koly" class="img-fluid py-2 col-md-6 col-sm-12">
    </div>

    <div class="d-flex justify-content-between align-items-center mb-4 bg-white p-4 rounded shadow-sm">
        <div>
            <h2 class="mb-0">Volba 2. ciz√≠ho jazyka</h2>
            <p class="text-muted mb-0">
                P≈ôihl√°≈°en√Ω student:
                <strong class="d-block d-md-inline text-dark" th:text="${student.jmeno} + ' ' + ${student.prijmeni}">
                    Jan Nov√°k
                </strong>
                <span class="badge bg-secondary ms-md-2" th:text="'T≈ô√≠da ' + ${student.trida}">T≈ô√≠da A</span>
            </p>
        </div>
        <a href="/logout" class="btn btn-outline-danger align-self-center">Odhl√°sit se</a>
    </div>

    <div class="alert alert-warning shadow-sm d-flex flex-column flex-md-row justify-content-between align-items-center mb-5" role="alert">
        <div>
            <strong>‚è≥ Zb√Ωvaj√≠c√≠ ƒças pro v√Ωbƒõr:</strong>
            <span id="countdown" class="fw-bold fs-5 ms-2 font-monospace">Naƒç√≠t√°m...</span>
        </div>
        <div class="text-muted small mt-2 mt-md-0 text-center text-md-end">
            Registrace se uzav√≠r√°:<br>
            <strong th:text="${#temporals.format(konecRegistrace, 'd. MMMM yyyy HH:mm')}">5. z√°≈ô√≠ 2026 20:00</strong>
        </div>
    </div>
    <input type="hidden" id="konec-registrace-iso" th:value="${konecRegistrace}">
    <div th:if="${success}" class="alert alert-success shadow-sm" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-danger shadow-sm" th:text="${error}"></div>

    <div th:if="${mojeVolba != null}" class="text-center py-5">
        <div class="card shadow mx-auto border-success" style="max-width: 600px;">
            <div class="card-body p-5">
                <h1 class="display-1 text-success">‚úÖ</h1>
                <h3 class="mt-3">M√°te hotovo!</h3>
                <p class="lead">Zvolil(a) jste si: <strong class="text-success" th:text="${mojeVolba.jazyk.nazevJazyka}">Nƒõmƒçina</strong></p>
                <hr>

                <p class="text-muted mb-4">Chcete zmƒõnit n√°zor?</p>
                <form action="/zrusit-jazyk" method="post"
                      onsubmit="return confirm('Opravdu chcete zru≈°it svou volbu? M√≠sto m≈Ø≈æe mezit√≠m obsadit nƒõkdo jin√Ω.');">
                    <button type="submit" class="btn btn-outline-danger">
                        Zru≈°it volbu a vybrat znovu üîÑ
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div th:if="${mojeVolba == null}">
        <p class="lead text-center mb-4">Pros√≠m, zvolte si jeden z dostupn√Ωch jazyk≈Ø pro va≈°i t≈ô√≠du (<strong th:text="${student.trida}">A</strong>). <br>
            <small class="text-muted">Str√°nka se aktualizuje automaticky, sledujte voln√° m√≠sta.</small></p>

        <div class="row g-4">
            <div class="col-md-6 col-sm-12" th:each="jazyk : ${jazyky}">
                <div class="card h-100 shadow-sm transition-card"
                     th:classappend="${jazyk.jePlno()} ? 'border-danger bg-secondary-subtle' : 'border-primary'">

                    <div class="card-body text-center d-flex flex-column">
                        <h3 class="card-title fw-bold mb-3" th:text="${jazyk.nazevJazyka}">Angliƒçtina</h3>

                        <div class="mt-auto">
                            <div class="d-flex justify-content-between mb-1">
                                <span th:class="${jazyk.jePlno()} ? 'text-danger fw-bold' : 'text-muted'">
                                    <span th:text="${jazyk.jePlno()} ? 'PLNO' : 'Voln√° m√≠sta:'"></span>
                                </span>
                                <span class="fw-bold">
                                    <span th:text="${jazyk.maxKapacita - jazyk.aktualniPocetRegistrovanych}">5</span> /
                                    <span th:text="${jazyk.maxKapacita}">20</span>
                                </span>
                            </div>

                            <div class="progress mb-4" style="height: 15px;">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                                     th:style="'width: ' + ${(jazyk.aktualniPocetRegistrovanych * 100.0) / jazyk.maxKapacita} + '%'"
                                     th:classappend="${jazyk.jePlno()} ? 'bg-danger' : 'bg-success'">
                                </div>
                            </div>

                            <form action="/zapis-jazyka" method="post">
                                <input type="hidden" name="jazykId" th:value="${jazyk.jazykId}">

                                <button type="submit" class="btn w-100 py-2 fw-bold"
                                        th:classappend="${jazyk.jePlno()} ? 'btn-secondary disabled' : 'btn-primary'"
                                        th:disabled="${jazyk.jePlno()}">
                                    <span th:text="${jazyk.jePlno()} ? 'Obsazeno üîí' : 'Zvolit tento jazyk üëâ'"></span>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    (function() {
        // Naƒçteme datum z hidden inputu
        const isoInput = document.getElementById('konec-registrace-iso');

        // Pokud input neexistuje nebo je pr√°zdn√Ω, skript ukonƒç√≠me
        if (!isoInput || !isoInput.value) return;

        const countDownDate = new Date(isoInput.value).getTime();

        // Aktualizace ka≈ædou sekundu
        const x = setInterval(function() {
            const now = new Date().getTime();
            const distance = countDownDate - now;

            const element = document.getElementById("countdown");
            if (!element) return;

            if (distance < 0) {
                clearInterval(x);
                element.innerHTML = "REGISTRACE UKONƒåENA";
                element.classList.remove("text-dark");
                element.classList.add("text-danger");

                // Voliteln√©: Zneaktivnit tlaƒç√≠tka
                const buttons = document.querySelectorAll('button[type="submit"]');
                buttons.forEach(btn => btn.disabled = true);
            } else {
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                element.innerHTML =
                    (days > 0 ? days + "d " : "") +
                    (hours < 10 ? "0" + hours : hours) + "h " +
                    (minutes < 10 ? "0" + minutes : minutes) + "m " +
                    (seconds < 10 ? "0" + seconds : seconds) + "s";
            }
        }, 1000);
    })();
</script>

</body>
</html>